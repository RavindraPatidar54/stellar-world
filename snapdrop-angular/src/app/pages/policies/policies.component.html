<div class="policies-page">
  <!-- Header Section -->
  <div class="page-header">
    <div class="header-content">
      <div class="header-left">
        <h1 class="page-title">Policies</h1>
        
        <!-- Search Bar -->
        <div class="search-container">
          <mat-icon class="search-icon">search</mat-icon>
          <input 
            type="text" 
            class="search-input"
            placeholder="Search policies..."
            [(ngModel)]="searchTerm"
            (input)="onSearchChange()"
          >
          <mat-icon class="filter-icon">tune</mat-icon>
        </div>
      </div>
      
      <div class="header-actions">
        <button class="btn btn-primary" (click)="openCreateModal()">
          <mat-icon>add</mat-icon>
          Add new policy
        </button>
      </div>
    </div>
  </div>

  <!-- Table Section -->
  <div class="table-container">
    <table class="table">
      <thead>
        <tr>
          <th class="checkbox-col">
            <input 
              type="checkbox" 
              [checked]="allPoliciesSelected"
              [indeterminate]="someePoliciesSelected"
              (change)="toggleAllPolicies()"
            >
          </th>
          <th>Policy ID</th>
          <th>Name</th>
          <th>Type</th>
          <th>Filter Value</th>
          <th>Target</th>
          <th>Last Updated</th>
          <th>Creation Time</th>
          <th>Activated/Deactivated</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let policy of filteredPolicies" class="table-row">
          <td class="checkbox-col">
            <input 
              type="checkbox" 
              [checked]="isPolicySelected(policy.id)"
              (change)="togglePolicySelection(policy.id)"
            >
          </td>
          <td class="policy-id">{{ policy.id }}</td>
          <td class="policy-name">{{ policy.name }}</td>
          <td class="policy-type">{{ policy.type }}</td>
          <td class="filter-value">{{ policy.filterValue }}</td>
          <td class="target">{{ policy.target }}</td>
          <td class="last-updated">{{ policy.lastUpdated }}</td>
          <td class="creation-time">{{ policy.creationTime }}</td>
          <td class="activation-col">
            <mat-slide-toggle
              [checked]="policy.activated"
              (change)="togglePolicyActivation(policy)"
              color="primary">
            </mat-slide-toggle>
          </td>
          <td class="status-col">
            <span [class]="'badge ' + getStatusClass(policy.status)">
              {{ policy.status }}
            </span>
          </td>
          <td class="action-col">
            <div class="action-buttons">
              <button class="action-btn edit-btn" (click)="editPolicy(policy.id)">
                <mat-icon>edit</mat-icon>
              </button>
              <button class="action-btn delete-btn" (click)="openDeleteConfirmation(policy.id)">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div class="pagination-container">
    <div class="pagination-info">
      Showing <strong>1</strong> to <strong>20</strong> of <strong>20</strong> pages
    </div>
    <div class="pagination-controls">
      <button class="pagination-btn" disabled>
        <mat-icon>first_page</mat-icon>
      </button>
      <button class="pagination-btn" disabled>
        <mat-icon>chevron_left</mat-icon>
      </button>
      <span class="page-info">1 of 20 pages</span>
      <button class="pagination-btn">
        <mat-icon>chevron_right</mat-icon>
      </button>
      <button class="pagination-btn">
        <mat-icon>last_page</mat-icon>
      </button>
    </div>
    <div class="page-size">
      <select class="form-select">
        <option>100</option>
        <option>50</option>
        <option>25</option>
      </select>
      <span>Records</span>
    </div>
  </div>
</div>

<!-- Create Policy Modal -->
<div class="modal-overlay" *ngIf="showCreateModal" (click)="closeCreateModal()">
  <div class="modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3 class="modal-title">Create New Policy</h3>
      <button class="close-btn" (click)="closeCreateModal()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    
    <form [formGroup]="createPolicyForm" (ngSubmit)="createPolicy()">
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Name *</label>
          <input 
            type="text" 
            class="form-control"
            placeholder="Add Policy Name"
            formControlName="name"
          >
        </div>
        
        <div class="form-group">
          <label class="form-label">Description</label>
          <textarea 
            class="form-control"
            placeholder="Policy Description"
            rows="3"
            formControlName="description">
          </textarea>
        </div>
        
        <div class="form-group">
          <label class="form-label">Type *</label>
          <select class="form-control form-select" formControlName="type">
            <option value="Domain">Domain</option>
            <option value="IP Port">IP Port</option>
            <option value="Application">Application</option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" formControlName="applyPolicy">
            Apply this policy
          </label>
        </div>
      </div>
      
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeCreateModal()">
          Cancel
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="!createPolicyForm.valid">
          Add
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Bulk Upload Modal -->
<div class="modal-overlay" *ngIf="showBulkUploadModal" (click)="closeBulkUploadModal()">
  <div class="modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3 class="modal-title">Upload File</h3>
      <button class="close-btn" (click)="closeBulkUploadModal()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    
    <div class="modal-body">
      <div class="upload-area">
        <div class="upload-dropzone">
          <mat-icon class="upload-icon">upload_file</mat-icon>
          <p class="upload-text">Drag and drop your files here to upload</p>
        </div>
        
        <div class="upload-divider">OR</div>
        
        <div class="file-select">
          <input type="file" id="file-input" hidden (change)="onFileSelected($event)">
          <label for="file-input" class="file-label">
            <mat-icon>description</mat-icon>
            Sample file.abc
          </label>
        </div>
        
        <button class="btn btn-ghost download-template" (click)="downloadTemplate()">
          <mat-icon>download</mat-icon>
          Download the upload format here
        </button>
      </div>
    </div>
    
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" (click)="closeBulkUploadModal()">
        Cancel
      </button>
      <button type="button" class="btn btn-primary" (click)="uploadFile()">
        Upload
      </button>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal-overlay" *ngIf="showDeleteConfirmation" (click)="closeDeleteConfirmation()">
  <div class="modal modal-sm" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3 class="modal-title">Confirmation</h3>
      <button class="close-btn" (click)="closeDeleteConfirmation()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    
    <div class="modal-body">
      <p>Are you sure you want to delete this policy?</p>
    </div>
    
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" (click)="closeDeleteConfirmation()">
        No
      </button>
      <button type="button" class="btn btn-danger" (click)="deletePolicy()">
        Delete
      </button>
    </div>
  </div>
</div>

<!-- Success Notification -->
<div class="success-notification" *ngIf="showSuccessMessage" [@fadeIn]>
  <div class="notification-content">
    <mat-icon class="success-icon">check_circle</mat-icon>
    <span>Success</span>
    <span class="notification-text">{{ successMessage }}</span>
    <button class="notification-close" (click)="showSuccessMessage = false">
      <mat-icon>close</mat-icon>
    </button>
  </div>
</div>

<!-- Add New Policy Dropdown (positioned) -->
<div class="add-policy-dropdown" *ngIf="false">
  <div class="dropdown-menu">
    <button class="dropdown-item" (click)="openCreateModal()">
      <mat-icon>add</mat-icon>
      Create new
    </button>
    <button class="dropdown-item" (click)="openBulkUploadModal()">
      <mat-icon>upload</mat-icon>
      Upload file
    </button>
  </div>
</div>
